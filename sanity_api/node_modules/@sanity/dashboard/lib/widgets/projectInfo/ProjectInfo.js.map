{"version":3,"file":"ProjectInfo.js","names":["versionedClient","config","projectId","dataset","isUrl","url","test","getGraphQlUrl","getGroqUrl","getManageUrl","ProjectInfo","React","PureComponent","studioHost","graphqlApi","componentDidMount","subscriptions","push","observable","request","uri","subscribe","next","result","setState","error","console","log","method","statusCode","componentWillUnmount","forEach","sub","unsubscribe","assembleTableRows","state","propsData","props","data","title","rows","value","apps","concat","filter","item","category","Boolean","length","otherStuff","Object","keys","render","__experimental_before","map","widgetConfig","idx","String","width","row","isPlainObject","wordBreak","PropTypes","array"],"sources":["../../../src/widgets/projectInfo/ProjectInfo.js"],"sourcesContent":["/* eslint-disable react/forbid-prop-types, no-console */\nimport React from 'react'\nimport {isPlainObject} from 'lodash'\nimport PropTypes from 'prop-types'\nimport {Box, Card, Stack, Heading, Grid, Label, Text, Code, Button} from '@sanity/ui'\nimport {versionedClient} from '../../versionedClient'\nimport {DashboardWidget} from '../../'\nimport {WidgetContainer} from '../../legacyParts'\n\nconst {projectId, dataset} = versionedClient.config()\n\nfunction isUrl(url) {\n  return /^https?:\\/\\//.test(`${url}`)\n}\n\nfunction getGraphQlUrl() {\n  return `https://${projectId}.api.sanity.io/v1/graphql/${dataset}/default`\n}\n\nfunction getGroqUrl() {\n  return `https://${projectId}.api.sanity.io/v1/groq/${dataset}`\n}\n\nfunction getManageUrl() {\n  return `https://manage.sanity.io/projects/${projectId}`\n}\n\nclass ProjectInfo extends React.PureComponent {\n  static propTypes = {\n    // eslint-disable-next-line camelcase\n    __experimental_before: PropTypes.array,\n    data: PropTypes.array,\n  }\n  static defaultProps = {\n    // eslint-disable-next-line camelcase\n    __experimental_before: [],\n    data: [],\n  }\n\n  state = {\n    studioHost: null,\n    graphqlApi: null,\n  }\n\n  componentDidMount() {\n    // fetch project data\n    this.subscriptions = []\n\n    this.subscriptions.push(\n      versionedClient.observable.request({uri: `/projects/${projectId}`}).subscribe({\n        next: (result) => {\n          const {studioHost} = result\n          this.setState({studioHost: studioHost ? `https://${studioHost}.sanity.studio` : null})\n        },\n        error: (error) => {\n          console.log('Error while looking for studioHost', error)\n          this.setState({\n            studioHost: {\n              error: 'Something went wrong while looking up studioHost. See console.',\n            },\n          })\n        },\n      })\n    )\n\n    // ping assumed graphql endpoint\n    this.subscriptions.push(\n      versionedClient.observable\n        .request({\n          method: 'HEAD',\n          uri: `/graphql/${dataset}/default`,\n        })\n        .subscribe({\n          next: () => this.setState({graphqlApi: getGraphQlUrl()}),\n          error: (error) => {\n            if (error.statusCode === 404) {\n              this.setState({graphqlApi: null})\n            } else {\n              console.log('Error while looking for graphqlApi', error)\n              this.setState({\n                graphqlApi: {\n                  error: 'Something went wrong while looking up graphqlApi. See console.',\n                },\n              })\n            }\n          },\n        })\n    )\n  }\n\n  componentWillUnmount() {\n    this.subscriptions.forEach((sub) => sub.unsubscribe())\n  }\n\n  assembleTableRows() {\n    const {graphqlApi, studioHost} = this.state\n    const propsData = this.props.data\n\n    let result = [\n      {\n        title: 'Sanity project',\n        rows: [\n          {title: 'Project ID', value: projectId},\n          {title: 'Dataset', value: dataset},\n        ],\n      },\n    ]\n\n    // Handle any apps\n    const apps = [studioHost ? {title: 'Studio', value: studioHost} : null]\n      .concat(propsData.filter((item) => item.category === 'apps'))\n      .filter(Boolean)\n    if (apps.length > 0) {\n      result = result.concat([{title: 'Apps', rows: apps}])\n    }\n\n    // Handle APIs\n    result = result.concat(\n      [\n        {\n          title: 'APIs',\n          rows: [\n            {title: 'GROQ', value: getGroqUrl()},\n            {title: 'GraphQL', value: graphqlApi || 'Not deployed'},\n          ],\n        },\n      ],\n      propsData.filter((item) => item.category === 'apis')\n    )\n\n    // Handle whatever else there might be\n    const otherStuff = {}\n    propsData.forEach((item) => {\n      if (item.category !== 'apps' && item.category !== 'apis') {\n        if (!otherStuff[item.category]) {\n          otherStuff[item.category] = []\n        }\n        otherStuff[item.category].push(item)\n      }\n    })\n    Object.keys(otherStuff).forEach((category) => {\n      result.push({title: category, rows: otherStuff[category]})\n    })\n\n    return result\n  }\n\n  render() {\n    return (\n      <>\n        {this.props.__experimental_before &&\n          this.props.__experimental_before.map((widgetConfig, idx) => (\n            <WidgetContainer key={String(idx)} config={widgetConfig} />\n          ))}\n        <Box height=\"fill\" marginTop={this.props.__experimental_before?.length > 0 ? 4 : 0}>\n          <DashboardWidget\n            footer={\n              <Button\n                style={{width: '100%'}}\n                paddingX={2}\n                paddingY={4}\n                mode=\"bleed\"\n                tone=\"primary\"\n                text=\"Manage project\"\n                as=\"a\"\n                href={getManageUrl()}\n              />\n            }\n          >\n            <Card\n              paddingY={4}\n              radius={2}\n              role=\"table\"\n              aria-label=\"Project info\"\n              aria-describedby=\"project_info_table\"\n            >\n              <Stack space={4}>\n                <Box paddingX={3} as=\"header\">\n                  <Heading size={1} as=\"h2\" id=\"project_info_table\">\n                    Project info\n                  </Heading>\n                </Box>\n                {this.assembleTableRows().map((item) => {\n                  if (!item || !item.rows) {\n                    return null\n                  }\n\n                  return (\n                    <Stack key={item.title} space={3}>\n                      <Card borderBottom padding={3}>\n                        <Label size={0} muted role=\"columnheader\">\n                          {item.title}\n                        </Label>\n                      </Card>\n                      <Stack space={4} paddingX={3} role=\"rowgroup\">\n                        {item.rows.map((row) => {\n                          return (\n                            <Grid key={row.title} columns={2} role=\"row\">\n                              <Text weight=\"medium\" role=\"rowheader\">\n                                {row.title}\n                              </Text>\n                              {isPlainObject(row.value) && <Text size={1}>{row.value.error}</Text>}\n                              {!isPlainObject(row.value) && (\n                                <>\n                                  {isUrl(row.value) ? (\n                                    <Text size={1} role=\"cell\" style={{wordBreak: 'break-word'}}>\n                                      <a href={row.value}>{row.value}</a>\n                                    </Text>\n                                  ) : (\n                                    <Code size={1} role=\"cell\" style={{wordBreak: 'break-word'}}>\n                                      {row.value}\n                                    </Code>\n                                  )}\n                                </>\n                              )}\n                            </Grid>\n                          )\n                        })}\n                      </Stack>\n                    </Stack>\n                  )\n                })}\n              </Stack>\n            </Card>\n          </DashboardWidget>\n        </Box>\n      </>\n    )\n  }\n}\n\nexport default ProjectInfo\n"],"mappings":"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"}