{"version":3,"file":"ProjectUsers.js","names":["AvatarWrapper","styled","Card","getInviteUrl","projectId","sortUsersByRobotStatus","userA","userB","project","members","membershipA","find","member","id","membershipB","isRobot","ProjectUsers","React","PureComponent","users","error","fetchData","componentDidMount","componentWillUnmount","subscription","unsubscribe","versionedClient","config","observable","request","uri","pipe","switchMap","userStore","getUsers","map","mem","subscribe","next","setState","Array","isArray","sort","render","state","isLoading","handleRetryFetch","cursor","width","undefined","user","membership","media","imageUrl","displayName","role"],"sources":["../../../src/widgets/projectUsers/ProjectUsers.js"],"sourcesContent":["// @todo: remove the following line when part imports has been removed from this file\n///<reference types=\"@sanity/types/parts\" />\n\nimport React from 'react'\nimport {map, switchMap} from 'rxjs/operators'\nimport {Stack, Card, Box, Text, Button} from '@sanity/ui'\nimport {RobotIcon} from '@sanity/icons'\nimport styled from 'styled-components'\nimport {DefaultPreview} from '@sanity/base/components'\nimport Spinner from 'part:@sanity/components/loading/spinner'\nimport {versionedClient} from '../../versionedClient'\nimport {DashboardWidget} from '../../'\nimport {userStore} from '../../legacyParts'\n\nconst AvatarWrapper = styled(Card)`\n  box-sizing: border-box;\n  border-radius: 50%;\n  border-color: transparent;\n  overflow: hidden;\n  width: 100%;\n  height: 100%;\n\n  & > img {\n    width: 100%;\n    height: auto;\n  }\n`\n\nfunction getInviteUrl(projectId) {\n  return `https://manage.sanity.io/projects/${projectId}/team/invite`\n}\n\nfunction sortUsersByRobotStatus(userA, userB, project) {\n  const {members} = project\n  const membershipA = members.find((member) => member.id === userA.id)\n  const membershipB = members.find((member) => member.id === userB.id)\n  if (membershipA.isRobot) {\n    return 1\n  }\n  if (membershipB.isRobot) {\n    return -1\n  }\n  return 0\n}\n\nclass ProjectUsers extends React.PureComponent {\n  static propTypes = {}\n  static defaultProps = {}\n\n  state = {\n    project: null,\n    users: null,\n    error: null,\n  }\n\n  componentDidMount() {\n    this.fetchData()\n  }\n\n  componentWillUnmount() {\n    if (this.subscription) {\n      this.subscription.unsubscribe()\n    }\n  }\n\n  fetchData() {\n    if (this.subscription) {\n      this.subscription.unsubscribe()\n    }\n\n    const {projectId} = versionedClient.config()\n    this.subscription = versionedClient.observable\n      .request({\n        uri: `/projects/${projectId}`,\n      })\n      .pipe(\n        switchMap((project) =>\n          userStore.observable\n            .getUsers(project.members.map((mem) => mem.id))\n            .pipe(map((users) => ({project, users})))\n        )\n      )\n      .subscribe({\n        next: ({users, project}) =>\n          this.setState({\n            project,\n            users: (Array.isArray(users) ? users : [users]).sort((userA, userB) =>\n              sortUsersByRobotStatus(userA, userB, project)\n            ),\n          }),\n        error: (error) => this.setState({error}),\n      })\n  }\n\n  handleRetryFetch = () => {\n    this.fetchData()\n  }\n\n  render() {\n    const {error, project, users} = this.state\n    const isLoading = !users || !project\n\n    if (error) {\n      return (\n        <DashboardWidget header=\"Project users\">\n          <Box padding={4}>\n            <Text>\n              Something went wrong while fetching data. You could{' '}\n              <a\n                onClick={this.handleRetryFetch}\n                title=\"Retry users fetch\"\n                style={{cursor: 'pointer'}}\n              >\n                retry\n              </a>\n              ..?\n            </Text>\n          </Box>\n        </DashboardWidget>\n      )\n    }\n\n    return (\n      <DashboardWidget\n        header=\"Project users\"\n        footer={\n          <Button\n            style={{width: '100%'}}\n            paddingX={2}\n            paddingY={4}\n            mode=\"bleed\"\n            tone=\"primary\"\n            text=\"Invite members\"\n            as=\"a\"\n            loading={isLoading}\n            href={isLoading ? undefined : getInviteUrl(project.id)}\n          />\n        }\n      >\n        {isLoading && (\n          <Card padding={4}>\n            <Spinner center message=\"Loading...\" />\n          </Card>\n        )}\n\n        {!isLoading && (\n          <Stack space={3} padding={3}>\n            {users.map((user) => {\n              const membership = project.members.find((member) => member.id === user.id)\n              const media = membership.isRobot ? (\n                <Text size={3}>\n                  <RobotIcon />\n                </Text>\n              ) : (\n                <AvatarWrapper tone=\"transparent\">\n                  {user?.imageUrl && <img src={user.imageUrl} alt={user?.displayName} />}\n                </AvatarWrapper>\n              )\n              return (\n                <Box key={user.id}>\n                  <DefaultPreview\n                    title={user.displayName}\n                    subtitle={membership.role}\n                    media={media}\n                  />\n                </Box>\n              )\n            })}\n          </Stack>\n        )}\n      </DashboardWidget>\n    )\n  }\n}\n\nexport default ProjectUsers\n"],"mappings":"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"}